# Image Conversion Tracker: 画像変換追跡システムの設計と実証

## 要約
本稿では、ノードベースのビジュアルワークフローエディタを核とする「Image Conversion Tracker」の設計と実装計画を述べる。Vanilla JavaScriptで構築された軽量クライアントが、Replicate APIを経由した画像生成・編集を統合し、モデルごとの挙動を可視化する。SeaDream 4.0、Nano Banana、Nano Banana Proを対象に、(1)画像編集（姿勢・服装・向き変換）と(2)画像変換（同一画像への色付け・領域着色）の2実験を設計し、トレーサビリティと変換品質を評価する。LLMサイドでは io net を用いたプロンプト生成・ログ補完を想定する。主要な貢献は、追跡性を重視したワークフロー設計、Replicate API／Cloudflare Workerによる安全な推論実行、モデル比較実験の評価指標設計である。

## 1. 序論
- 画像生成・編集の透明性（変換履歴、失敗時ログ、部分成功保存）の不足が現状課題。
- 目的：Image Conversion Trackerにより、複数モデルの画像変換を一貫したパイプラインで管理・記録し、品質と再現性を確保する。
- 対象モデル：SeaDream 4.0、Nano Banana、Nano Banana Pro。
- 想定利用：クリエイティブ制作のフィードバックループ、データ生成の再現性検証、A/Bモデル比較。

## 2. システム概要
### 2.1 クライアント
- Vanilla JavaScriptベース、フレームワーク非依存のノードエディタ。
- 入力ノード（手動アップロード）と生成ノード（AI生成のみ）を色分け表示し、プロンプト・モデル設定をノードに付随させる。
- 画像拡大モーダル、サムネイルのアスペクト保持、右クリック／ショートカット対応などの操作性改善を想定。

### 2.2 サーバ／API
- Replicate APIをHTTPS越しに呼び出す。APIキーはUIから入力し、Cloudflare Worker経由で安全に管理。
- R2ストレージへ生成物と予測JSONを保存し、`GET /image/:key`で配信する。
- 24秒ポーリング＋クライアント継続ポーリングで推論完了を監視。

### 2.3 ログと追跡
- 変換成功／失敗ログ、部分成功の保存、最大3回リトライを実装。
- ノード操作やワークフロー保存を即時反映し、変換履歴を保持。

## 3. 実験設計
### 3.1 画像編集（pose/服装/向き）
- 入力：人物画像（____件）、プロンプト：姿勢変更、服装変更、視線・向き変換。
- モデル：SeaDream 4.0 / Nano Banana / Nano Banana Pro。
- 指標（例）：構図整合度（CLIP類似度）、属性忠実度（姿勢・服装ラベル一致率）、美的評価（人手5段階）、失敗率／リトライ率（システムログ）。

### 3.2 画像変換（同一画像への色付け・領域変換）
- 入力：同一構図の線画またはグレースケール（____件）。
- タスク：部位ごとの色付け、部分領域の質感変更。
- 指標（例）：PSNR/SSIM（参照色付けとの一致）、領域IoU（マスク準拠）、推論時間、部分失敗率。

## 4. 評価プロトコル
1. データセット分割：編集用/変換用をそれぞれ train/val/test（____/____/____）。
2. プロンプト生成：io net経由で日本語→英語プロンプト変換、スタイル指示（____）。
3. 実行設定：解像度（1:1, 4:3, 3:4, 16:9, 9:16）を統一比較。
4. 推論：Replicate APIでバッチ実行、Cloudflare Workerで結果収集。
5. ログ集計：変換成否、リトライ回数、レスポンスタイム、R2保存キー。
6. 人手評価：盲検でモデル名を隠蔽し、多肢選択＋5段階尺度。

## 5. 想定テーブル
- 表1: モデル別リソース・設定（シード、解像度、ステップ数、Sampler、APIコスト）。
- 表2: 画像編集タスク結果（CLIP類似度、姿勢/服装一致率、美的スコア、失敗率）。
- 表3: 画像変換タスク結果（PSNR/SSIM、領域IoU、色差ΔE、部分失敗率）。
- 表4: 速度と安定性（平均推論時間、リトライ発生率、R2保存成功率）。

## 6. 考察
- Nano Banana系は高速・軽量が期待される一方、SeaDream 4.0は多彩なスタイル生成力を評価予定。
- Cloudflare Worker経由によりAPIキー秘匿とCORS課題を解消し、ブラウザ直呼び出しより安全性・信頼性が高い。
- 部分成功保存とリトライ制御がユーザ体験を底上げする設計ポイント。

## 7. 今後の課題
- データセットの公開可否と著作権整理（____）。
- LLM（io net）とのプロンプト共同最適化フローの自動化。
- アクセシビリティと多言語UIの改善（____）。
- 大規模実験のコスト最適化（スポット推論、結果キャッシュ）。

## 8. まとめ
本稿はImage Conversion Trackerによる画像変換パイプラインの設計と、SeaDream 4.0／Nano Banana／Nano Banana Proを用いた編集・変換タスクの比較計画を示した。Replicate APIとCloudflare Workerを組み合わせることで、ブラウザ中心の軽量なワークフローと堅牢なキー管理・ログ追跡を両立する。実装・評価結果は続報で報告する。

