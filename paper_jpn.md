# Image Conversion Tracker: 画像変換追跡システムの設計と実証

## 要約
本稿では、ノードベースのビジュアルワークフローエディタを核とする「Image Conversion Tracker」の設計と実装計画を論文形式で提示する。Vanilla JavaScriptで構築された軽量クライアントが、Replicate APIを経由した画像生成・編集を統合し、モデルごとの挙動を可視化する。SeaDream 4.0、Nano Banana、Nano Banana Proを対象に、(1)画像編集（姿勢・服装・向き変換）と(2)画像変換（同一画像への色付け・領域着色）の2実験を設計し、トレーサビリティと変換品質を評価する。LLMサイドでは io net を用いたプロンプト生成・ログ補完を想定する。主要な貢献は、背景としてのimage-to-image conversion研究の進展を踏まえ、チャット型UIでは扱いにくい分岐・再試行を追跡できるワークフロー設計を示し、Replicate API／Cloudflare Workerによる安全な推論実行とモデル比較実験の評価指標設計を体系化した点である。

## 1. 序論
- 背景：大規模生成モデルの登場により、汎用モデルを個別課題へ転用するimage-to-image conversion技術が急速に発展している。特に拡散モデルの発展は色付け・姿勢変更・スタイル転写などの多様な変換を高精度化した。
- 課題：一方で、チャットベースのLLMエージェントは分岐やリトライを伴う煩雑な処理過程を追跡できず、並列プロンプト生成や条件分岐を含むワークフロー管理が想定されていない。
- 目的：Image Conversion Trackerにより、複数モデルの画像変換を一貫したパイプラインで管理・記録し、品質・再現性・透明性を確保する。
- 対象モデル：SeaDream 4.0、Nano Banana、Nano Banana Pro。
- 想定利用：クリエイティブ制作のフィードバックループ、データ生成の再現性検証、A/Bモデル比較に加え、希少データ領域における弱学習モデル用データセット作成の道筋を示す。

## 2. 背景と関連研究
- image-to-image conversionの最近の進歩として、拡散モデルや大規模事前学習モデルによる条件付き生成が高精細化し、プロンプトの細粒度制御や領域指定（ControlNet系、マスク生成）が一般化した。
- 大規模モデルの蒸留・圧縮が進み、汎用モデルで得た性能を軽量モデルへ移植するアプローチが活発化している。これにより、推論コストを抑えたオンデバイス適用や、ドメイン特化の微調整が現実的になった。
- しかし、生成過程の追跡性やログ構造を伴う評価枠組みは十分に整備されておらず、入力・プロンプト・出力を結びつけるデータモデルが欠落している。本研究はこのギャップを埋めるため、ワークフローとログ管理を統合したプラットフォームを提案する。

## 3. システム概要
### 3.1 クライアント
- Vanilla JavaScriptベース、フレームワーク非依存のノードエディタ。
- 入力ノード（手動アップロード）と生成ノード（AI生成のみ）を色分け表示し、プロンプト・モデル設定をノードに付随させる。
- 画像拡大モーダル、サムネイルのアスペクト保持、右クリック／ショートカット対応などの操作性改善を想定。

### 3.2 サーバ／API
- Replicate APIをHTTPS越しに呼び出す。APIキーはUIから入力し、Cloudflare Worker経由で安全に管理。
- R2ストレージへ生成物と予測JSONを保存し、`GET /image/:key`で配信する。
- 24秒ポーリング＋クライアント継続ポーリングで推論完了を監視。

### 3.3 ログと追跡
- 変換成功／失敗ログ、部分成功の保存、最大3回リトライを実装。
- ノード操作やワークフロー保存を即時反映し、変換履歴を保持。

### 3.4 Methodsとシステムの独自性
- システムはAI agentで作成し、プロンプト生成・ログ補完・ワークフロー更新を自動化する。チャットベースUIでは保持しづらい分岐情報をノードグラフとして保存し、試行錯誤の分岐を可視化する。
- APIはReplicateを用いて推論を実行し、io.netを用いてプロンプト生成や翻訳を行う。Cloudflare Worker経由で鍵管理とCORS制御を行い、安全性と再現性を担保する。
- 独自性：ノードグラフによる分岐管理、推論ログとサムネイルの紐付け保存、リトライ・部分成功の保存戦略、そして大規模モデルの蒸留を意識したデータ生成パイプラインを統合する。蒸留を前提とした弱学習モデルのデータセット構築を、実験ログから自動抽出する設計を志向する。
- 応用：画像変換の追跡をサポートする処理ワークフロー管理プラットフォームとして、生成手順の再現性と評価の透明性を保証し、蒸留やドメイン適応に必要な中間データを整備する。

## 4. 実験設計
### 4.1 画像編集（pose/服装/向き）
- 入力：人物画像（____件）、プロンプト：姿勢変更、服装変更、視線・向き変換。
- モデル：SeaDream 4.0 / Nano Banana / Nano Banana Pro。
- 指標（例）：構図整合度（CLIP類似度）、属性忠実度（姿勢・服装ラベル一致率）、美的評価（人手5段階）、失敗率／リトライ率（システムログ）。

### 4.2 画像変換（同一画像への色付け・領域変換）
- 入力：同一構図の線画またはグレースケール（____件）。
- タスク：部位ごとの色付け、部分領域の質感変更。
- 指標（例）：PSNR/SSIM（参照色付けとの一致）、領域IoU（マスク準拠）、推論時間、部分失敗率。

## 5. 評価プロトコル
1. データセット分割：編集用/変換用をそれぞれ train/val/test（____/____/____）。
2. プロンプト生成：io net経由で日本語→英語プロンプト変換、スタイル指示（____）。
3. 実行設定：解像度（1:1, 4:3, 3:4, 16:9, 9:16）を統一比較。
4. 推論：Replicate APIでバッチ実行、Cloudflare Workerで結果収集。
5. ログ集計：変換成否、リトライ回数、レスポンスタイム、R2保存キー。
6. 人手評価：盲検でモデル名を隠蔽し、多肢選択＋5段階尺度。

## 6. 想定テーブル
- 表1: モデル別リソース・設定（シード、解像度、ステップ数、Sampler、APIコスト）。
- 表2: 画像編集タスク結果（CLIP類似度、姿勢/服装一致率、美的スコア、失敗率）。
- 表3: 画像変換タスク結果（PSNR/SSIM、領域IoU、色差ΔE、部分失敗率）。
- 表4: 速度と安定性（平均推論時間、リトライ発生率、R2保存成功率）。

## 7. 考察
- Nano Banana系は高速・軽量が期待される一方、SeaDream 4.0は多彩なスタイル生成力を評価予定。
- Cloudflare Worker経由によりAPIキー秘匿とCORS課題を解消し、ブラウザ直呼び出しより安全性・信頼性が高い。
- 部分成功保存とリトライ制御がユーザ体験を底上げする設計ポイント。
- 蒸留を見据えたデータセット構築により、希少データ領域での弱学習モデルの性能向上を図れる可能性がある。

## 8. 今後の課題
- データセットの公開可否と著作権整理（____）。
- LLM（io net）とのプロンプト共同最適化フローの自動化。
- アクセシビリティと多言語UIの改善（____）。
- 大規模実験のコスト最適化（スポット推論、結果キャッシュ）。

## 9. まとめ
本稿はImage Conversion Trackerによる画像変換パイプラインの設計と、SeaDream 4.0／Nano Banana／Nano Banana Proを用いた編集・変換タスクの比較計画を示した。image-to-image conversionの進展と大規模モデルの蒸留という背景から、チャットベースUIでは難しい分岐・追跡をノードグラフで補完する意義を論じた。Replicate APIとCloudflare Workerを組み合わせることで、ブラウザ中心の軽量なワークフローと堅牢なキー管理・ログ追跡を両立し、弱学習モデル向けデータセット作成にも応用可能な基盤を提示した。実装・評価結果は続報で報告する。

